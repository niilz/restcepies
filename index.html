<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Rezepte macher</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
</head>
<body>
    <header>
        <h1>Rezeptmaker</h1>
        <nav class="nav">
            <ul>
                <li>home</li>
                <li>about</li>
                <li>log in</li>
            </ul>
        </nav>
    </header>

    <div>
        <form class="form">
            <select class="select" name="einkaufsliste" form="einkaufsform">
                <option value="tomaten">Tomaten</option>
                <option value="salat">Salat</option>
                <option value="fleisch">Fleisch</option>
                <option value="fisch">Fisch</option>
            </select>
            <button class="button">Gib Rezept</button>
        </form>
    </div>

    <section class="view">

    </section>
    
    <script>
        
        let zutat = document.querySelector(".select").value
        let baseUrlR = "http://food2fork.com/api/search?key="
        let baseUrlZ = "http://food2fork.com/api/get?key="

        //local dev-Section
        // let fetchRezepteLocal = () => fetch('rezepte.json')
        //     .then(response => response.json())
        //     .then(json => json.recipes.map(num => [num.recipe_id, num.title]))

        // let displayLocal = idTitlePairs => {
        //         idTitlePairs.forEach((pair,i) => {
        //             let view = document.querySelector(".view")
        //             let recipe = document.createElement("div")
        //             view.appendChild(recipe)
        //             let para1 = document.createElement("p")
        //             recipe.appendChild(para1)
        //             let id = document.createTextNode(pair[0])
        //             para1.appendChild(id)
        //             let para2 = document.createElement("p")
        //             view.appendChild(para2)
        //             let name = document.createTextNode(pair[1])
        //             recipe.appendChild(para2)
        //             para2.appendChild(name)
        //         })
        //     }  
        
        let apiKey = jsonfile => fetch(jsonfile)
            .then(res => res.json())
            .then(json => (json[0].apiKey))

        //console.log(apiKey("config.json"))


        let fetchRezepte = () => apiKey("config.json")
            .then(key => fetch(baseUrlR + key + "q=shredded%20chicken",{
            method: "GET",
            mode: "cors",
            }))
            .then(response => response.json())
            .then(json => json.recipes.map(num => [num.recipe_id, num.title]))
            
        
        let fetchZutaten = (idTitleArrays) => {
            let recTriplets = {}
            apiKey("config.json")
            .then(key => idTitleArrays.forEach((iTArray, i) => fetch(baseUrlZ + key + "rId=" + iTArray[0],{
            method: "GET",
            mode: "cors",
            })
            .then(response => response.json())
            .then(json => json.recipe)
            .then(recipe => {
                recTriplets[i] = {}
                recTriplets[i].name = iTArray[1]
                recTriplets[i].img = recipe.image_url
                recTriplets[i].ingredients = recipe.ingredients
                })
            ))
            return recTriplets
        }

        let display = selection => {
            Object.keys(selection).forEach(triplet => {
                let view = document.querySelector(".view")
                let para = document.createElement("p")
                let text = document.createTextNode(selection[triplet].name)
                para.appendChild(text)
                view.appendChild(para)
            })
        }  

        fetchRezepte()
        .then(arrays => fetchZutaten(arrays))
        .then(triplets => console.log(triplets))
      
        
  


        //let button = document.querySelector(".button").addEventListener("click", display)
   
    </script>
</body>
</html>